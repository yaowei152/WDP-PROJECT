{% extends "base.html" %}

{% block header %}
    Orders Management
{% endblock %}

{% block content %}

<style>
    /* Filter Bar Styles */
    .filter-container {
        background: white; padding: 20px; border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 25px;
        display: flex; flex-wrap: wrap; gap: 15px; align-items: center; border: 1px solid #eee;
    }
    .filter-group { display: flex; flex-direction: column; gap: 5px; }
    .filter-label { font-size: 12px; font-weight: 600; color: #7f8c8d; text-transform: uppercase; }
    .filter-input, .filter-select { padding: 10px 12px; border: 1px solid #dcdcdc; border-radius: 6px; font-size: 14px; min-width: 150px; }
    .btn-filter { background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: auto; height: 42px; }
    .btn-reset { background-color: #ecf0f1; color: #7f8c8d; border: 1px solid #bdc3c7; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: auto; height: 42px; text-decoration: none; display: flex; align-items: center; }
    
    /* High Contrast Badges */
    .badge {
        padding: 6px 12px; border-radius: 20px; font-weight: 700; font-size: 12px;
        text-transform: uppercase; display: inline-block; letter-spacing: 0.5px;
        color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .badge-Pending { background-color: #f39c12; }
    .badge-Invoiced { background-color: #27ae60; }
</style>

<form method="GET" action="{{ url_for('orders') }}" class="filter-container">
    <div class="filter-group" style="flex: 1; min-width: 250px;">
        <label class="filter-label">Search</label>
        <input type="text" name="search" class="filter-input" placeholder="ORD-2025..., Client, Desc..." value="{{ request.args.get('search', '') }}">
    </div>
    <div class="filter-group">
        <label class="filter-label">Invoice Status</label>
        <select name="status" class="filter-select">
            <option value="All" {% if request.args.get('status') == 'All' %}selected{% endif %}>All Orders</option>
            <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
            <option value="Invoiced" {% if request.args.get('status') == 'Invoiced' %}selected{% endif %}>Invoiced</option>
        </select>
    </div>
    <div class="filter-group">
        <label class="filter-label">Sort By</label>
        <select name="sort" class="filter-select">
            <option value="date_desc" {% if request.args.get('sort') == 'date_desc' %}selected{% endif %}>Newest First</option>
            <option value="date_asc" {% if request.args.get('sort') == 'date_asc' %}selected{% endif %}>Oldest First</option>
            <option value="price_high" {% if request.args.get('sort') == 'price_high' %}selected{% endif %}>Price: High to Low</option>
            <option value="price_low" {% if request.args.get('sort') == 'price_low' %}selected{% endif %}>Price: Low to High</option>
        </select>
    </div>
    <button type="submit" class="btn-filter"><i class="fa-solid fa-filter"></i> Apply</button>
    <a href="{{ url_for('orders') }}" class="btn-reset">Reset</a>
</form>

<div class="card">
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Client</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Date Placed</th>
                    <th style="text-align: center;">Status</th>
                    <th style="text-align: center;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td style="font-family: monospace; font-weight: bold; color: #555;">{{ order.order_code }}</td>
                    <td><strong>{{ order.client.name }}</strong><br><span style="font-size:12px; color:#999;">{{ order.client.company }}</span></td>
                    <td>{{ order.description }}</td>
                    <td style="font-weight: bold;">${{ "%.2f"|format(order.amount) }}</td>
                    <td>{{ order.date_placed.strftime('%Y-%m-%d') }}</td>
                    
                    <td style="text-align: center;">
                        <span class="badge badge-{{ order.status }}">{{ order.status }}</span>
                    </td>
                    
                    <td style="text-align: center;">
                        {% if order.status == 'Pending' %}
                            {% if g.user.role != 'Staff' %}
                                <a href="{{ url_for('create_invoice', order_id=order.id) }}" class="btn btn-success btn-sm">
                                    Generate Invoice
                                </a>
                            {% else %}
                                <span style="color: #ccc; font-size: 13px;">View Only</span>
                            {% endif %}
                        {% else %}
                            {% if order.invoice %}
                                <a href="{{ url_for('view_invoice', invoice_id=order.invoice.id) }}" class="btn btn-secondary btn-sm">
                                    View Invoice
                                </a>
                            {% else %}
                                <span style="color: #aaa; font-size: 13px;">Processed</span>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="7" style="text-align: center; padding: 30px; color: #7f8c8d;">No orders found matching your criteria.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}